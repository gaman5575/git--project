pipeline {
    agent any

    environment {
        DOCKER_USERNAME = 'gaman5575'
    }

    stages {
        stage('Git Checkout'){
            steps {
                // Checkout your source code repository
                git branch: 'main',
                    url: 'https://github.com/gaman5575/python-release.git'
            }
        }

        stage('Clone Repositories and Update Version.yaml') {
            steps {
                withCredentials([usernamePassword(credentialsId: 'git-credentials', usernameVariable: 'GIT_CREDENTIALS_USR', passwordVariable: 'GIT_CREDENTIALS_PSW')]) {
                    script {
                        def repos = ["local1", "local2"]
                        repos.each { repo ->
                            sh """
                                git clone https://${GIT_CREDENTIALS_USR}:${GIT_CREDENTIALS_PSW}@github.com/${GIT_CREDENTIALS_USR}/${repo}.git
                                cd ${repo}

                                # configuring Git
                                git config user.email '${GIT_CREDENTIALS_USR}@gmail.com'
                                git config user.name '${GIT_CREDENTIALS_USR}'

                                ls ../
                                rm -rvf ../${repo}

                            """
                        }
                    }
                }
            }
        }
    }
}
